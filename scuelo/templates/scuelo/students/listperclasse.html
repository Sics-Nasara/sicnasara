{% extends "../../layout.html" %}

<style>
    /* Custom styles for the student page */
    .form-control {
        border-radius: 20px;
        padding-left: 20px;
        padding-right: 40px;
    }

    .sortable {
        cursor: pointer;
    }

    .sortable i {
        margin-left: 5px;
    }

    .sort-icon {
        margin-left: 5px;
    }

    .sort-icon.asc::after {
        content: "\25b2";
    }

    .sort-icon.desc::after {
        content: "\25bc";
    }

    .important-info {
        display: flex;
        flex-wrap: nowrap;
        align-items: center;
        overflow-x: auto;
        padding-left: 10px;
        padding-right: 10px;
    }

    .important-info-value {
        margin-left: 10px;
        background-color: #343a40;
        padding: 5px 10px;
        border-radius: 10px;
        color: white;
    }

    /* Adjust table container width */
    .table-container {
        max-width: 100%;
        overflow-x: auto;
    }

    /* Breadcrumb styling */
    .breadcrumb-item a {
        color: #007bff;
        text-decoration: none;
    }

    .breadcrumb-item a:hover {
        color: #0056b3;
        text-decoration: underline;
    }

    .breadcrumb {
        background-color: transparent;
        padding: 0;
        margin-bottom: 20px;
    }

    /* Table styling */
    .table {
        width: 100%;
        border-collapse: collapse;
    }

    .table th,
    .table td {
        padding: 12px;
        border: 1px solid #dee2e6;
        text-align: center;
        background-color: #f8f9fa;
    }

    .table th {
        background-color: #007bff;
        color: white;
        text-transform: uppercase;
    }

    .table tbody tr:hover {
        background-color: #f1f3f5;
    }

    .table tbody tr:nth-child(even) {
        background-color: #f8f9fa;
    }

    /* Button styling */
    .btn {
        border-radius: 25px;
        padding: 10px 15px;
        font-size: 16px;
        transition: background-color 0.3s, box-shadow 0.3s;
    }

    .btn-primary {
        background-color: #007bff;
        border: none;
    }

    .btn-primary:hover {
        background-color: #0056b3;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .btn-warning {
        background-color: #ffc107;
        border: none;
    }

    .btn-warning:hover {
        background-color: #e0a800;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }

    /* Table adjustments for smaller screens */
    @media (max-width: 768px) {
        .table th,
        .table td {
            font-size: 14px;
        }

        .important-info-value {
            font-size: 14px;
        }

        .btn {
            font-size: 14px;
        }
    }
</style>

{% block important_info %}
<ul class="navbar-nav important-info">
    <li class="nav-item">
        <a class="nav-link text-white" href="#">
            <span class="important-info-value">{{ classe.nom }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link text-white" href="#">
            Total élèves: <span class="important-info-value">{{ total_students }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link text-white" href="#">
            Filles: <span class="important-info-value">{{ total_girls }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link text-white" href="#">
            Garçons: <span class="important-info-value">{{ total_boys }}</span>
        </a>
    </li>
    <li class="nav-item">
        <a class="nav-link text-white" href="#">
            Total frais: <span class="important-info-value">{{ total_fees }}</span>
        </a>
    </li>
</ul>
{% endblock %}

{% block content %}
<ol class="breadcrumb">
    {% for link, label in breadcrumbs %}
    {% if forloop.last %}
    <li class="breadcrumb-item active" aria-current="page">{{ label }}</li>
    {% else %}
    <li class="breadcrumb-item"><a href="{{ link }}">{{ label }}</a></li>
    {% endif %}
    {% endfor %}
</ol>

<a href="{% url 'manage_tarifs' classe.pk %}" class="btn btn-primary">
    <i class="fas fa-money-check-alt"></i> Gérer les Tarifs
</a>

<!-- Main content -->
<div class="content-container row mt-4">
    <div class="col">
        <div class="table-responsive table-container w-100">
            <table class="table table-striped table-bordered" id="studentTable">
                <thead>
                    <tr>
                        <th class="sortable" data-sort="id">ID</th>
                        <th class="sortable" data-sort="nom">Nom</th>
                        <th class="sortable" data-sort="prenom">Prénom</th>
                        <th class="sortable" data-sort="condition">Condition</th>
                        <th class="sortable" data-sort="sex">Sexe</th>
                        <th class="sortable" data-sort="date_naissance">Date naissance</th>
                        <th class="sortable" data-sort="total_payment">Total payé</th>
                        <th class="sortable" data-sort="note_eleve">Note</th>
                        <th class="sortable" data-sort="cs_py">CS_PY</th>
                        <th class="sortable" data-sort="hand">Hand</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td data-column="id">{{ student.pk }}</td>
                        <td data-column="nom">{{ student.nom }}</td>
                        <td data-column="prenom">{{ student.prenom }}</td>
                        <td data-column="condition">{{ student.get_condition_eleve_display }}</td>
                        <td data-column="sex">{{ student.get_sex_display }}</td>
                        <td data-column="date_naissance">{{ student.date_naissance }}</td>
                        <td data-column="total_payment">
                            {% if student.total_payment == 0 %}
                            -
                            {% else %}
                            {{ student.total_payment }}
                            {% endif %}
                        </td>
                        <td data-column="note_eleve">{{ student.note_eleve }}</td>
                        <td data-column="cs_py">{{ student.get_cs_py_display }}</td>
                        <td data-column="hand">
                            {% if student.hand %}
                            {{ student.get_hand_display }}
                            {% else %}
                            <!-- Display blank if no handicap -->
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'student_detail' student.pk %}" class="btn btn-warning btn-sm">
                                <i class="fas fa-pencil-alt"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const table = document.getElementById('studentTable');
        const headers = table.querySelectorAll('.sortable');
        let sortDirection = {};
        
        headers.forEach(header => {
            header.addEventListener('click', () => {
                const column = header.getAttribute('data-sort');
                const direction = sortDirection[column] === 'asc' ? 'desc' : 'asc';
                sortTable(column, direction);
                sortDirection[column] = direction;
                
                headers.forEach(h => {
                    h.classList.remove('asc', 'desc');
                });
                
                header.classList.toggle('asc', direction === 'asc');
                header.classList.toggle('desc', direction === 'desc');
            });
        });
        
        function sortTable(column, direction) {
            const rows = Array.from(table.querySelector('tbody').rows);
            const compare = (a, b) => {
                let cellA = a.querySelector(`td[data-column="${column}"]`)?.innerText.trim();
                let cellB = b.querySelector(`td[data-column="${column}"]`)?.innerText.trim();
                
                if (!isNaN(cellA) && !isNaN(cellB)) {
                    cellA = parseFloat(cellA);
                    cellB = parseFloat(cellB);
                }
                
                if (direction === 'asc') {
                    return cellA > cellB ? 1 : -1;
                } else {
                    return cellA < cellB ? 1 : -1;
                }
            };
            rows.sort(compare);
            rows.forEach(row => table.querySelector('tbody').appendChild(row));
        }

        sortTable('nom', 'asc');
    });
</script>
{% endblock content %}
